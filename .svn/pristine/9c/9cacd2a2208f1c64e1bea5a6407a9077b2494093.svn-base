package com.bochat.app.business.main;

import android.app.Activity;
import android.content.Intent;

import com.alibaba.android.arouter.launcher.ARouter;
import com.bochat.app.app.RouteExtra;
import com.bochat.app.app.RouteTable;
import com.bochat.app.business.DaggerBusinessComponent;
import com.bochat.app.common.contract.MainContract;
import com.bochat.app.common.util.ALog;
import com.bochat.app.model.bean.FriendEntity;
import com.bochat.app.model.bean.GroupEntity;
import com.bochat.app.mvp.presenter.BasePresenter;

import io.rong.imkit.RongIM;

/**
 * Author      : FJ
 * CreateDate  : 2019/04/11 19:35
 * Description :
 */

public class BoChatPresenter extends BasePresenter<MainContract.View> implements MainContract.Presenter {
    
    @Override
    public void initInjector() {
        DaggerBusinessComponent.create().inject(this);
    }
    
    @Override
    public void onViewRefresh() {
        super.onViewRefresh();
        final Intent intent = getView().getViewIntent();
        if(intent.hasExtra(RouteExtra.ChangeTab_Int)){
            int tabPosition = intent.getIntExtra(RouteExtra.ChangeTab_Int, 0);
            getView().changeTab(tabPosition);
            getView().setViewIntent(new Intent());
        }
        if(intent.hasExtra(RouteExtra.GroupEntity)) {
            GroupEntity entity = (GroupEntity)intent.getSerializableExtra(RouteExtra.GroupEntity);
            RongIM.getInstance().startGroupChat((Activity)getView().getViewContext(),
                    entity.getGroup_id()+"", entity.getGroup_name());
        }
        if(intent.hasExtra(RouteExtra.FriendEntity)){
            FriendEntity entity = (FriendEntity)intent.getSerializableExtra(RouteExtra.FriendEntity);
            ALog.d("receive " + entity);
            ARouter.getInstance().build(RouteTable.BOOK_ADDRESS_FRIEND_DETAIL)
                    .withString(RouteExtra.ConversationId_String, String.valueOf(entity.getId())).navigation();
        }
        getView().setViewIntent(new Intent());
    }

    @Override
    public void onCreate() {
        
    }

    @Override
    public void onDestroy() {

    }
}
