package com.bochat.app.app.activity;

import android.os.Bundle;
import android.support.v4.view.ViewPager;
import android.support.v7.widget.DefaultItemAnimator;
import android.support.v7.widget.GridLayoutManager;
import android.support.v7.widget.RecyclerView;
import android.view.View;

import com.alibaba.android.arouter.facade.annotation.Route;
import com.bochat.app.R;
import com.bochat.app.app.adapter.DynamicViewPagerAdapter;
import com.bochat.app.app.adapter.ListAppAdapter;
import com.bochat.app.app.adapter.ListAppMainViewPagerAdapter;
import com.bochat.app.app.adapter.ListAppTopGridAdapter;
import com.bochat.app.app.fragment.ListAppFragment;
import com.bochat.app.app.util.ResourceUtils;
import com.bochat.app.common.contract.dynamic.ListAppActivityContract;
import com.bochat.app.common.router.Router;
import com.bochat.app.common.router.RouterDynamitAppList;
import com.bochat.app.common.router.RouterListAppDetail;
import com.bochat.app.common.router.RouterSearchApp;
import com.bochat.app.common.util.ULog;
import com.bochat.app.model.bean.AppListBannerEntity;
import com.bochat.app.model.bean.AppListBannerListEntity;
import com.bochat.app.model.bean.DynamicBannerEntity;
import com.bochat.app.model.bean.DynamicBannerListEntity;
import com.bochat.app.model.bean.DynamicShopGameEntity;
import com.bochat.app.model.bean.DynamicShopGameListEntity;
import com.bochat.app.model.bean.DynamicShopTypeEntity;
import com.bochat.app.model.bean.DynamicShopTypeListEntity;
import com.bochat.app.model.bean.ViewPagerItemJumpEntity;
import com.bochat.app.mvp.view.BaseActivity;
import com.bumptech.glide.load.engine.Resource;

import java.util.ArrayList;
import java.util.List;

import javax.inject.Inject;

import butterknife.BindView;
import butterknife.OnClick;

/**
 * 2019/5/8
 * Author LDL
 **/
@Route(path = RouterDynamitAppList.PATH)
public class ListAppActivity extends BaseActivity<ListAppActivityContract.Presenter> implements ListAppActivityContract.View , ListAppMainViewPagerAdapter.OnPagerClick {

    @Inject
    ListAppActivityContract.Presenter presenter;

    @BindView(R.id.list_app_top_grid)
    RecyclerView mListAppTopGrid;

    @BindView(R.id.list_app_bottom_grid)
    RecyclerView mListAppBottomGrid;

    @BindView(R.id.list_app_activity)
    ViewPager list_app_activity;

    private ListAppMainViewPagerAdapter viewPagerAdapter;


    private int[] top_icons = {R.mipmap.ic_application_selected,
            R.mipmap.ic_application_game,
            R.mipmap.ic_application_life,
            R.mipmap.ic_application_finance,
            R.mipmap.ic_application_social_contact,
            R.mipmap.ic_application_media,
            R.mipmap.ic_application_tool,
            R.mipmap.ic_application_other};
    private String[] top_names = {"精选", "游戏", "生活", "金融", "社交", "媒体", "工具", "其他"};
    private ListAppTopGridAdapter mListAppTopGridAdapter;


    @Override
    protected void initInjector() {
        getActivityComponent().inject(this);
    }

    @Override
    protected ListAppActivityContract.Presenter initPresenter() {
        return presenter;
    }

    @Override
    protected void setRootView(Bundle savedInstanceState) {
        setContentView(R.layout.activity_listapp);
    }

    @Override
    protected void initWidget() {

        mListAppTopGridAdapter = new ListAppTopGridAdapter(this);
        mListAppTopGridAdapter.setOnItemClickListener(new ListAppTopGridAdapter.OnItemClickListener() {
            @Override
            public void onItemClick(View view, DynamicShopTypeEntity entity) {
                RouterListAppDetail detailRouter = new RouterListAppDetail();
                detailRouter.setEntity(entity);
                Router.navigation(detailRouter);
            }
        });
//        List<ListAppTopGridAdapter.TestItem> topGridTest = new ArrayList<>();

//        for (int i = 0; i < top_icons.length; i++)
//            topGridTest.add(new ListAppTopGridAdapter.TestItem(top_icons[i], top_names[i]));
        setRecyclerViewConfiguration(mListAppTopGrid, mListAppTopGridAdapter, 4);

        List<DynamicShopGameEntity> bottomGridItems = new ArrayList<>();

        for (int i = 0; i < 4; i++) {
            DynamicShopGameEntity test = new DynamicShopGameEntity();
            test.setName("名称名称");
            test.setDescribes("BoChat-区块链社交平...");
            bottomGridItems.add(test);
        }

        ListAppAdapter adapter = new ListAppAdapter(bottomGridItems, this);
        mListAppBottomGrid.addItemDecoration(new ListAppFragment.SpacesItemDecoration(ResourceUtils.dip2px(this, R.dimen.dp_13)));
        setRecyclerViewConfiguration(mListAppBottomGrid, adapter, 2);

        presenter.getAppStoreType();
    }

    void setRecyclerViewConfiguration(RecyclerView view, RecyclerView.Adapter adapter, int spanCount) {
        view.setLayoutManager(new GridLayoutManager(this, spanCount));
        view.setItemAnimator(new DefaultItemAnimator());
        view.setAdapter(adapter);
    }

    @OnClick({R.id.list_app_back_menu, R.id.list_app_scan_layout, R.id.list_app_search_layout})
    @Override
    protected void onViewClicked(View view) {
        switch (view.getId()) {
            case R.id.list_app_back_menu:
                finish();
                break;
            case R.id.list_app_scan_layout:
                break;
            case R.id.list_app_search_layout:
                Router.navigation(new RouterSearchApp());
                break;
            default:
                break;
        }
    }

    @Override
    public void getType(DynamicShopTypeListEntity entity) {
        mListAppTopGridAdapter.notifyData(entity.getData());
    }

    @Override
    public void getBannerForYyscSuccess(DynamicBannerListEntity entity) {
        viewPagerAdapter=new ListAppMainViewPagerAdapter(entity.getData(),this);
        viewPagerAdapter.setOnPagerClick(this);
        list_app_activity.setAdapter(viewPagerAdapter);
    }

    @Override
    public void searchAppListSuccess(DynamicShopGameListEntity entity) {

    }

    @Override
    public void onPageItemClick(int position, DynamicBannerEntity entity) {

    }
}
