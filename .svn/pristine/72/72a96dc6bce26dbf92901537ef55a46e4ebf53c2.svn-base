package com.bochat.app.app.adapter;

import android.content.Context;
import android.support.annotation.NonNull;
import android.support.v7.widget.RecyclerView;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.TextView;

import com.bochat.app.R;
import com.bochat.app.app.view.SpImageView;
import com.bochat.app.business.cache.CachePool;
import com.bochat.app.model.bean.GroupApplyEntity;
import com.bochat.app.model.bean.GroupEntity;
import com.bumptech.glide.Glide;

import java.util.ArrayList;
import java.util.List;

import static com.bochat.app.app.view.SpImageView.TYPE_ROUND;
import static com.bochat.app.model.constant.Constan.FRIEND_APPLY_ACCOUNT;
import static com.bochat.app.model.constant.Constan.FRIEND_APPLY_CODE;

/**
 * 2019/4/22
 * Author LDL
 **/
public class GroupApplyAdapter extends RecyclerView.Adapter<GroupApplyAdapter.GroupApplyViewHolder> {

    private  List<GroupApplyEntity> list;
    private Context context;
    private GroupApplyAdapter.OnItemClickListenner onItemClickListenner;
    private List<GroupEntity> groupList ;

    public GroupApplyAdapter(Context context, List<GroupApplyEntity> list){
        this.context=context;
        if(list==null){
            list=new ArrayList<>();
        }
        this.list=list;
        this.groupList = CachePool.getInstance().group().getAll();
    }

    public void refreshOne(int position,GroupApplyEntity friendApplyEntity){
        list.remove(position);
        list.add(position,friendApplyEntity);
        notifyItemChanged(position);
    }

    public void refreshData(List<GroupApplyEntity> list){
        if(list==null){
            list=new ArrayList<>();
        }
        this.list=list;
        notifyDataSetChanged();
    }

    public void setOnItemClickListenner(GroupApplyAdapter.OnItemClickListenner onItemClickListenner){
        this.onItemClickListenner=onItemClickListenner;
    }


    @NonNull
    @Override
    public GroupApplyViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View view= LayoutInflater.from(context).inflate(R.layout.fragment_apply_item,null,false);
        return new GroupApplyViewHolder(view);
    }

    @Override
    public void onBindViewHolder(@NonNull GroupApplyViewHolder holder, int position) {
        holder.head_img.setType(TYPE_ROUND);
        holder.head_img.setRoundRadius(context.getResources().getDimensionPixelOffset(R.dimen.dp_5));
        if(groupList!=null){
            for(int i=0;i<groupList.size();i++){
                if(list.get(position).getProposer_id().equals(groupList.get(i).getGroup_id()+"")){
                    list.get(position).setApply_state("2");
                    break;
                }
            }
        }
        if(list.get(position).getApply_state().equals("1")){
            holder.read_tx.setText("查看");
            holder.read_tx.setTextColor(context.getResources().getColor(R.color.color_4591EC));
            holder.read_tx.setBackground(context.getResources().getDrawable(R.drawable.apply_enable));
        }else if(list.get(position).getApply_state().equals("0")){
            holder.read_tx.setText("已拒绝");
            holder.read_tx.setTextColor(context.getResources().getColor(R.color.color_999999));
            holder.read_tx.setBackground(context.getResources().getDrawable(R.drawable.apply_unenable));
        }else if(list.get(position).getApply_state().equals("4")){
            holder.read_tx.setText("已过期");
            holder.read_tx.setTextColor(context.getResources().getColor(R.color.color_999999));
            holder.read_tx.setBackground(context.getResources().getDrawable(R.drawable.apply_unenable));
        }else{
            holder.read_tx.setTextColor(context.getResources().getColor(R.color.color_4591EC));
            holder.read_tx.setText("已通过");
            holder.read_tx.setBackground(context.getResources().getDrawable(R.drawable.apply_enable));
        }
        holder.content.setText(list.get(position).getApply_text());
        if(list.get(position).getSourceType()==FRIEND_APPLY_ACCOUNT){
            holder.infoFrom.setText("账号查找");
        }else if(list.get(position).getSourceType()==FRIEND_APPLY_CODE){
            holder.infoFrom.setText("二维码扫码");
        }else {
            holder.infoFrom.setText("群人员列表");
        }
        holder.userName.setText(list.get(position).getGroup_name());
        holder.head_img.setType(TYPE_ROUND);
        holder.head_img.setRoundRadius(context.getResources().getDimensionPixelSize(R.dimen.dp_10));
        Glide.with(context).load(list.get(position).getGroup_head()).error(R.mipmap.default_head).into(holder.head_img);
    }

    @Override
    public int getItemCount() {
        return list.size();
    }

    class GroupApplyViewHolder extends RecyclerView.ViewHolder implements View.OnClickListener {

        TextView read_tx;
        TextView content;
        TextView userName;
        TextView infoFrom;
        SpImageView head_img;


        public GroupApplyViewHolder(View itemView) {
            super(itemView);
            itemView.setOnClickListener(this);
            read_tx=itemView.findViewById(R.id.read_tx);
            content=itemView.findViewById(R.id.content);
            userName=itemView.findViewById(R.id.userName);
            infoFrom=itemView.findViewById(R.id.infoFrom);
            head_img=itemView.findViewById(R.id.head_img);
        }

        @Override
        public void onClick(View v) {
            if(onItemClickListenner!=null){
                onItemClickListenner.onItemClick(getPosition(),list.get(getPosition()));
            }
        }
    }

    public interface OnItemClickListenner{
        void onItemClick(int position, GroupApplyEntity friendApplyEntity);
    }

}
